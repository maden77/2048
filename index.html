<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>2048 Fix</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #faf8ef;
      text-align: center;
      margin: 0;
      padding: 20px;
    }
    h1 {
      font-size: 60px;
      color: #776e65;
    }
    .header {
      display: flex;
      justify-content: space-between;
      max-width: 500px;
      margin: 0 auto 20px;
    }
    .score-box {
      background: #bbada0;
      color: white;
      padding: 10px 15px;
      border-radius: 5px;
      font-weight: bold;
      min-width: 60px;
    }
    .score-title {
      font-size: 12px;
      color: #eee4da;
    }
    .score-value {
      font-size: 20px;
    }
    button {
      background: #8f7a66;
      color: white;
      border: none;
      border-radius: 5px;
      padding: 10px 15px;
      font-weight: bold;
      cursor: pointer;
      margin-bottom: 20px;
    }
    .grid {
      width: 100%;
      max-width: 460px;
      aspect-ratio: 1;
      background: #bbada0;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 15px;
      padding: 15px;
      margin: 0 auto;
      position: relative;
    }
    .cell {
      background: rgba(238, 228, 218, 0.35);
      border-radius: 5px;
      width: 100%;
      aspect-ratio: 1;
    }
    .tile {
      position: absolute;
      width: 100px;
      height: 100px;
      border-radius: 5px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: bold;
      font-size: 45px;
      transition: all 0.1s ease;
      color: #776e65;
    }
    .tile-2 { background: #eee4da; }
    .tile-4 { background: #ede0c8; }
    .tile-8 { background: #f2b179; color: white; }
    .tile-16 { background: #f59563; color: white; }
    .tile-32 { background: #f67c5f; color: white; }
    .tile-64 { background: #f65e3b; color: white; }
    .tile-128 { background: #edcf72; color: white; }
    .tile-256 { background: #edcc61; color: white; }
    .tile-512 { background: #edc850; color: white; }
    .tile-1024 { background: #edc53f; color: white; font-size: 35px; }
    .tile-2048 { background: #edc22e; color: white; font-size: 35px; }
    @media (max-width: 480px) {
      .tile {
        width: 60px;
        height: 60px;
        font-size: 24px;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>2048</h1>
    <div class="score-box">
      <div class="score-title">SCORE</div>
      <div id="score" class="score-value">0</div>
    </div>
    <div class="score-box">
      <div class="score-title">BEST</div>
      <div id="best" class="score-value">0</div>
    </div>
  </div>
  <button id="new-game">New Game</button>
  <div class="grid" id="grid"></div>

  <script>
    const gridElement = document.getElementById("grid");
    const scoreElement = document.getElementById("score");
    const bestElement = document.getElementById("best");
    const newGameButton = document.getElementById("new-game");

    let grid = [];
    let score = 0;
    let best = localStorage.getItem("bestScore") || 0;

    const tileSize = 100;
    const tileGap = 15;
    const padding = 15;

    function init() {
      grid = Array(4).fill().map(() => Array(4).fill(0));
      gridElement.innerHTML = "";

      // Buat cell statis
      for (let i = 0; i < 16; i++) {
        const cell = document.createElement("div");
        cell.className = "cell";
        gridElement.appendChild(cell);
      }

      score = 0;
      updateScore();
      addRandomTile();
      addRandomTile();
      updateTiles();
    }

    function updateScore() {
      scoreElement.textContent = score;
      if (score > best) {
        best = score;
        bestElement.textContent = best;
        localStorage.setItem("bestScore", best);
      }
    }

    function addRandomTile() {
      const empty = [];
      for (let r = 0; r < 4; r++) {
        for (let c = 0; c < 4; c++) {
          if (grid[r][c] === 0) empty.push({ r, c });
        }
      }
      if (empty.length > 0) {
        const { r, c } = empty[Math.floor(Math.random() * empty.length)];
        grid[r][c] = Math.random() < 0.9 ? 2 : 4;
      }
    }

    function updateTiles() {
      document.querySelectorAll(".tile").forEach(e => e.remove());

      for (let r = 0; r < 4; r++) {
        for (let c = 0; c < 4; c++) {
          const val = grid[r][c];
          if (val !== 0) {
            const tile = document.createElement("div");
            tile.className = `tile tile-${val}`;
            tile.textContent = val;
            tile.style.top = `${r * (tileSize + tileGap) + padding}px`;
            tile.style.left = `${c * (tileSize + tileGap) + padding}px`;
            gridElement.appendChild(tile);
          }
        }
      }
      updateScore();
    }

    function move(direction) {
      let moved = false;
      let old = JSON.stringify(grid);

      const rotate = (g) => g[0].map((_, i) => g.map(r => r[i]).reverse());

      if (direction === "up") grid = rotate(grid);
      if (direction === "down") grid = rotate(rotate(rotate(grid)));

      for (let r = 0; r < 4; r++) {
        let row = grid[r].filter(n => n);
        for (let i = 0; i < row.length - 1; i++) {
          if (row[i] === row[i + 1]) {
            row[i] *= 2;
            score += row[i];
            row[i + 1] = 0;
          }
        }
        row = row.filter(n => n);
        while (row.length < 4) row.push(0);
        grid[r] = row;
      }

      if (direction === "up") grid = rotate(rotate(rotate(grid)));
      if (direction === "down") grid = rotate(grid);

      if (JSON.stringify(grid) !== old) {
        moved = true;
        addRandomTile();
        updateTiles();
      }
    }

    document.addEventListener("keydown", (e) => {
      if (e.key === "ArrowLeft") move("left");
      if (e.key === "ArrowRight") move("right");
      if (e.key === "ArrowUp") move("up");
      if (e.key === "ArrowDown") move("down");
    });

    newGameButton.onclick = init;
    bestElement.textContent = best;
    init();
  </script>
</body>
</html>
